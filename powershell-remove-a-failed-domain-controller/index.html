<!doctype html>
<html class="position-relative" itemscope itemtype="https://schema.org/WebPage" lang="en"
  data-bs-theme="auto" data-palette="blue">
  <head><script src="/assets/init/bundle.min.ae263b8da19abebb94fcca26add68dc0c86f7d189b9bb2379b1258467d5579f1.js" integrity="sha256-riY7jaGavruU/MomrdaNwMhvfRibm7I3mxJYRn1VefE=" crossorigin="anonymous"></script>
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PowerShell: Remove a failed domain controller - Eric&#39;s Blog</title>
    <link rel="icon" href="/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_16x16_resize_box_3.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_32x32_resize_box_3.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_150x150_resize_box_3.png" sizes="150x150" type="image/png">
    <link rel="apple-touch-icon" href="/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_180x180_resize_box_3.png" sizes="180x180" type="image/png">
    <link rel="icon" href="/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_192x192_resize_box_3.png" sizes="192x192" type="image/png">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#6f42c1">
<meta name="keywords" content="" />
  <meta name="description" content="PowerShell: Remove a failed domain controller Version: 1.0.1
Introduction: Let&rsquo;s face it, removing a domain controller via the GUI is easy, but sometimes you just want to know how to automate something. In my research there was a lot of resources on how to cleanup using the GUI, or via NTDS. Nothing about utilizing PowerShell.
Parameters Let&rsquo;s start by estalishing some parameters
#Array to hold roles of original DC $All_Roles_To_Move = New-Object -TypeName &#34;System." /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PowerShell: Remove a failed domain controller"/>
<meta name="twitter:description" content="PowerShell: Remove a failed domain controller Version: 1.0.1
Introduction: Let&rsquo;s face it, removing a domain controller via the GUI is easy, but sometimes you just want to know how to automate something. In my research there was a lot of resources on how to cleanup using the GUI, or via NTDS. Nothing about utilizing PowerShell.
Parameters Let&rsquo;s start by estalishing some parameters
#Array to hold roles of original DC $All_Roles_To_Move = New-Object -TypeName &#34;System."/>
<meta property="og:title" content="PowerShell: Remove a failed domain controller" />
<meta property="og:description" content="PowerShell: Remove a failed domain controller Version: 1.0.1
Introduction: Let&rsquo;s face it, removing a domain controller via the GUI is easy, but sometimes you just want to know how to automate something. In my research there was a lot of resources on how to cleanup using the GUI, or via NTDS. Nothing about utilizing PowerShell.
Parameters Let&rsquo;s start by estalishing some parameters
#Array to hold roles of original DC $All_Roles_To_Move = New-Object -TypeName &#34;System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ericcsinger.com/powershell-remove-a-failed-domain-controller/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-26T20:00:00+00:00" />
<meta property="article:modified_time" content="2020-11-26T20:00:00+00:00" />

<meta itemprop="name" content="PowerShell: Remove a failed domain controller">
<meta itemprop="description" content="PowerShell: Remove a failed domain controller Version: 1.0.1
Introduction: Let&rsquo;s face it, removing a domain controller via the GUI is easy, but sometimes you just want to know how to automate something. In my research there was a lot of resources on how to cleanup using the GUI, or via NTDS. Nothing about utilizing PowerShell.
Parameters Let&rsquo;s start by estalishing some parameters
#Array to hold roles of original DC $All_Roles_To_Move = New-Object -TypeName &#34;System."><meta itemprop="datePublished" content="2020-11-26T20:00:00+00:00" />
<meta itemprop="dateModified" content="2020-11-26T20:00:00+00:00" />
<meta itemprop="wordCount" content="807">
<meta itemprop="keywords" content="Active Directory,PowerShell," />

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-163410401-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<link data-precache rel="stylesheet" href="/assets/main/bundle.min.8665b86c0de590a692897e53fbf55330fb969c34f1d22790e6840ff406961a52.css" integrity="sha256-hmW4bA3lkKaSiX5T+/VTMPuWnDTx0ieQ5oQP9AaWGlI=" crossorigin="anonymous">

<link data-precache rel="stylesheet" href="/assets/katex/bundle.min.b236565f31a50508b5851cfb13938fa5a8d9f4fd00884efe2ad27a11b82968bf.css" integrity="sha256-sjZWXzGlBQi1hRz7E5OPpajZ9P0AiE7&#43;KtJ6EbgpaL8=" crossorigin="anonymous">

    <link data-precache rel="stylesheet" href="/assets/viewer/bundle.min.c8cc49b70e98e42caf70845e0d50f8e86821121688c2e5a5f6fc464d40154853.css" integrity="sha256-yMxJtw6Y5CyvcIReDVD46GghEhaIwuWl9vxGTUAVSFM=" crossorigin="anonymous">


</head>
  <body><header class="mb-4 sticky-top">
  
<nav class="top-app-bar shadow navbar navbar-expand-xxl">
  <div class="container">
<a class="navbar-brand d-flex align-items-center flex-grow-1 flex-xxl-grow-0 justify-content-xxl-start ms-2 ms-xxl-0 mx-auto me-xxl-2"
    href="https://ericcsinger.com/">Eric&#39;s Blog
</a>

    <div class="offcanvas-xxl offcanvas-end flex-grow-1" data-bs-scroll="true" tabindex="-1" id="navbarMenus" aria-labelledby="navbarMenusLabel">
      <div class="offcanvas-header px-4 pb-0">
        <div class="offcanvas-title h5" id="navbarMenusLabel">Eric&#39;s Blog</div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" data-bs-target="#navbarMenus" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body p-4 pt-0 p-xxl-0">
        <hr class="d-xxl-none">
        <ul class="navbar-nav flex-row flex-wrap align-items-center me-auto"><li class="nav-item col-6 col-xxl-auto">
            <a class="nav-link py-2 px-0 px-xxl-2" href="https://ericcsinger.com/about/">About
            </a>
          </li>
        </ul>
        
    <hr class="d-xxl-none">
    <form class="search-bar ms-auto my-1" action="" novalidate>
      <div class="input-group input-group-sm align-items-center">
        <span class="btn btn-search disabled position-absolute left-0 border-0 px-1">
          <i class="fas fa-fw fa-search fa-lg"></i>
        </span>
        <input
          class="my-1 form-control border-white rounded-5 search-input bg-body"
          name="q"
          type="search"
          placeholder="Search"
          aria-label="Search"
          required>
          <span class="search-shortcut position-absolute end-0 top-0 me-2">
            <kbd class="bg-primary rounded shadow">/</kbd>
          </span>
      </div>
    </form><hr class="d-xxl-none">
        <ul class="navbar-nav flex-row flex-wrap align-items-center ms-md-auto">
<li class="nav-item dropdown col-6 col-xxl-auto">
    <a class="nav-link px-0 py-2 px-xxl-1" href="#" id="paletteDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-fw fa-palette"></i>
        <span class="d-xxl-none">Palette</span>
    </a>
    <ul class="palette-dropdown-menu dropdown-menu dropdown-menu-end px-2 row g-2" aria-labelledby="paletteDropdown">
            <li class="col-4 my-1">
                <a role="button" id="palette-blue" aria-label="Blue"
                    class="btn btn-sm w-100 palette text-bg-blue" data-palette="blue">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-blue-gray" aria-label="Blue Gray"
                    class="btn btn-sm w-100 palette text-bg-blue-gray" data-palette="blue-gray">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-brown" aria-label="Brown"
                    class="btn btn-sm w-100 palette text-bg-brown" data-palette="brown">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-cyan" aria-label="Cyan"
                    class="btn btn-sm w-100 palette text-bg-cyan" data-palette="cyan">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-green" aria-label="Green"
                    class="btn btn-sm w-100 palette text-bg-green" data-palette="green">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-indigo" aria-label="Indigo"
                    class="btn btn-sm w-100 palette text-bg-indigo" data-palette="indigo">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-orange" aria-label="Orange"
                    class="btn btn-sm w-100 palette text-bg-orange" data-palette="orange">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-pink" aria-label="Pink"
                    class="btn btn-sm w-100 palette text-bg-pink" data-palette="pink">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-purple" aria-label="Purple"
                    class="btn btn-sm w-100 palette text-bg-purple" data-palette="purple">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-red" aria-label="Red"
                    class="btn btn-sm w-100 palette text-bg-red" data-palette="red">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-teal" aria-label="Teal"
                    class="btn btn-sm w-100 palette text-bg-teal" data-palette="teal">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-yellow" aria-label="Yellow"
                    class="btn btn-sm w-100 palette text-bg-yellow" data-palette="yellow">
                </a>
            </li>
    </ul>
</li>
<li class="nav-item dropdown col-6 col-xxl-auto">
    <a class="nav-link px-0 py-2 px-xxl-1" href="#" id="modeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="mode-icon fas fa-fw fa-adjust" id="modeIcon"></i>
        <span class="d-xxl-none">Mode</span>
    </a>
    <ul class="mode-dropdown-menu dropdown-menu dropdown-menu-end" aria-labelledby="modeDropdown">
        <li class="mode-item" data-color-mode="light" data-icon="sun">
            <button class="dropdown-item">
                <i class="mode-icon fas fa-fw fa-sun"></i> Light
            </button>
        </li>
        <li class="mode-item" data-color-mode="dark" data-icon="moon">
            <button class="dropdown-item">
                <i class="mode-icon fas fa-fw fa-moon"></i> Dark
            </button>
        </li>
        <li class="mode-item active" data-color-mode="auto" data-icon="adjust">
            <button class="dropdown-item">
                <i class="mode-icon fas fa-fw fa-adjust"></i> Auto
            </button>
        </li>
    </ul>
</li>
        </ul>
      </div>
    </div>
    <div class="d-flex">
      <button class="navbar-toggler order-5 border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#navbarMenus"
        aria-controls="navbarMenus" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-ellipsis-h"></i>
      </button>
    </div>
  </div>
</nav>

</header>

    <main class="container">
      <div class="row content"><noscript>
    <div class="alert alert-danger" role="alert">Your browser does not support JavaScript.</div>
</noscript>

<div class="col-xxl-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body pb-0">
    <ol class="hbs-breadcrumb breadcrumb flex-nowrap"><li class="breadcrumb-item text-surface"><a href="/">Home</a></li><li class="breadcrumb-item text-surface"><a href="/posts/">Posts</a></li><li class="breadcrumb-item active">PowerShell: Remove a failed domain controller</li></ol>
  </div>
</nav><div class="post-panel-wrapper position-relative d-flex justify-content-center">
  <div class="d-flex flex-row justify-content-center rounded-5 border post-panel position-fixed px-3 py-1 surface shadow-1">
    
    

    
    
    
  <a class="action action-toc d-none d-xxl-block" href="#postTOC" role="button" title="Table of contents">
    <i class="fas fa-fw fa-list-alt"></i>
  </a>
<a class="action action-toc d-block d-xxl-none" href="#post-toc-container" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    <a class="action action-copyright" href="#post-copyright" role="button" aria-label="Copyright" title="Copyright">
  <i class="fas fa-fw fa-copyright"></i>
</a>
    <a class="action action-post-comments" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    
<a id="sidebarToggler" class="action action-sidebar-toggler d-none d-xxl-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    
  </div>
</div><article class="row card component mb-4 post">
  <div class="card-header ">
    <h1 class="card-title post-title my-2">PowerShell: Remove a failed domain controller</h1>
  </div>
  <div class="card-body"><div class="post-meta mb-3">
  <span class="post-date me-1 mb-1" title="created on 2020-11-26 15:00:00 -0500 EST.">Thu, 26 Nov 2020 20:00:00 &#43;0000</span><span class="post-reading-time me-1 mb-1">4 min read</span><a href="/tags/active-directory/" class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Active Directory</a><a href="/tags/powershell/" class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Powershell</a>
</div>

<div class="mt-2 mb-3 d-block d-xxl-none">
    <h2 class="text-surface mb-3">Contents</h2>
    <div id="post-toc-container">
        </div>
    <hr class="text-secondary">
</div><div class="post-content mb-3" data-bs-spy="scroll" data-bs-target="#TableOfContents" tabindex="0">
        <div id="post-content-body"><h1 id="powershell-remove-a-failed-domain-controller" data-numberify>PowerShell: Remove a failed domain controller<a class="anchor ms-1" href="#powershell-remove-a-failed-domain-controller"></a></h1>
<p>Version: 1.0.1</p>
<h2 id="introduction" data-numberify>Introduction:<a class="anchor ms-1" href="#introduction"></a></h2>
<p>Let&rsquo;s face it, removing a domain controller via the GUI is easy, but sometimes you just want to know how to automate something.  In my research there was a lot of resources on how to cleanup using the GUI, or via NTDS.  Nothing about utilizing PowerShell.</p>
<h2 id="parameters" data-numberify>Parameters<a class="anchor ms-1" href="#parameters"></a></h2>
<p>Let&rsquo;s start by estalishing some parameters</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#75715e">#Array to hold roles of original DC</span>
</span></span><span style="display:flex;"><span>$All_Roles_To_Move = New-Object -TypeName <span style="color:#e6db74">&#34;System.Collections.ArrayList&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Name of the domain controller you&#39;d like to cleanup.  This should be the NETBIOS name, not the FQDN</span>
</span></span><span style="display:flex;"><span>$AD_DC_Name_To_Remove = <span style="color:#e6db74">&#34;Name-DC-Remove&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$AD_DC_Replacement_Name = <span style="color:#e6db74">&#34;Enter the name of the DC to move any FSMO roles too&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Name of your forrest domain name.  </span>
</span></span><span style="display:flex;"><span>$Forest_Fully_Qualified_Domain_Name = <span style="color:#e6db74">&#34;Forest.com&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#The netbios name of your domain.  if it&#39;s the same, leave it null</span>
</span></span><span style="display:flex;"><span>$NETBIOS_Domain_Name = $null
</span></span></code></pre></div><h2 id="getting-some-preliminary-domain-and-forest-information" data-numberify>Getting some preliminary domain and forest information<a class="anchor ms-1" href="#getting-some-preliminary-domain-and-forest-information"></a></h2>
<p>First we need some data that we don&rsquo;t have at the moment, like the all the domain information.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#75715e">#Formulate the FQDN of the domain</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($NULL <span style="color:#f92672">-eq</span> $NETBIOS_Domain_Name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    $Fully_Qualified_Domain_Name = $Forest_Domain_Name
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    $Fully_Qualified_Domain_Name = <span style="color:#e6db74">&#34;Domain.</span>$($Forest_Domain_Name)<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Formulate the FQDN of the former and new DC</span>
</span></span><span style="display:flex;"><span>$AD_DC_Name_To_Remove_Fully_Qualified_Domain_Name = <span style="color:#e6db74">&#34;</span>$($AD_DC_Name_To_Remove)$($Fully_Qualified_Domain_Name)<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>$AD_DC_Replacement_Name_Fully_Qualified_Domain_Name = <span style="color:#e6db74">&#34;</span>$($AD_DC_Replacement_Name )$($Fully_Qualified_Domain_Name)<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Getting the forest</span>
</span></span><span style="display:flex;"><span>$Forest = Get-ADForest -Identity $Forest_Domain_Name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Getting the domain</span>
</span></span><span style="display:flex;"><span>$Forest_Domain = Get-ADDomain -Identity $Forest_Fully_Qualified_Domain_Name
</span></span><span style="display:flex;"><span>$Domain = Get-ADDomain -Identity $Fully_Qualified_Domain_Name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Get all AD sites</span>
</span></span><span style="display:flex;"><span>$All_AD_Sites = Get-ADReplicationSite -Filter <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Get all DNS records</span>
</span></span><span style="display:flex;"><span>$All_DNS_Records = Get-DnsServerResourceRecord -ZoneName $Domain.DNSRoot -ComputerName $($AD_DC_Replacement_Name_Fully_Qualified_Domain_Name)
</span></span></code></pre></div><h2 id="sieze-them" data-numberify>Sieze Them!<a class="anchor ms-1" href="#sieze-them"></a></h2>
<p>Capture any roles that were once held by the original DC.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#75715e">#First let compile a list of all roles that need to be moved</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($Forest.SchemaMaster <span style="color:#f92672">-eq</span> $AD_DC_Name_To_Remove_Fully_Qualified_Domain_Name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    $All_Roles_To_Move.Add(<span style="color:#e6db74">&#34;SchemaMaster&#34;</span>) | out-null
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($Forest.DomainNamingMaster <span style="color:#f92672">-eq</span> $AD_DC_Name_To_Remove_Fully_Qualified_Domain_Name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    $All_Roles_To_Move.Add(<span style="color:#e6db74">&#34;DomainNamingMaster&#34;</span>) | out-null
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($Domain.PDCEmulator <span style="color:#f92672">-eq</span> $AD_DC_Name_To_Remove_Fully_Qualified_Domain_Name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    $All_Roles_To_Move.Add(<span style="color:#e6db74">&#34;PDCEmulator&#34;</span>) | out-null
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($Domain.RIDMaster <span style="color:#f92672">-eq</span> $AD_DC_Name_To_Remove_Fully_Qualified_Domain_Name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    $All_Roles_To_Move.Add(<span style="color:#e6db74">&#34;RIDMaster&#34;</span>) | out-null
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($Domain.InfrastructureMaster <span style="color:#f92672">-eq</span> $AD_DC_Name_To_Remove_Fully_Qualified_Domain_Name)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    $All_Roles_To_Move.Add(<span style="color:#e6db74">&#34;InfrastructureMaster&#34;</span>) | out-null
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Count all roles we need to move</span>
</span></span><span style="display:flex;"><span>$All_Roles_To_Move_Count = $All_Roles_To_Move | Measure-Object | select-object -expandproperty Count
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Determine if we have anything to move, and if so, move it.  Keep a note, this can take a while.  I think it needs to time out.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">If</span> ($All_Roles_To_Move_Count <span style="color:#f92672">-gt</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    Move-ADDirectoryServerOperationMasterRole -Identity $($AD_DC_Replacement_Name_Fully_Qualified_Domain_Name) -OperationMasterRole ($All_Roles_To_Move -join <span style="color:#e6db74">&#34;,&#34;</span>) -Force -PassThru
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h2 id="cleanup-our-sites-and-ntds" data-numberify>Cleanup our sites and NTDS<a class="anchor ms-1" href="#cleanup-our-sites-and-ntds"></a></h2>
<p>The DC lives in your sites&hellip; somewhere.  This will find it, and remove it.  This is also where we&rsquo;ll be using a simple onliner ntdsutil wrapped in PowerShell to formally cleanup the DC domain info.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">:</span>All_AD_Sites <span style="color:#66d9ef">Foreach</span> ($AD_Site <span style="color:#66d9ef">in</span> $All_AD_Sites)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    Write-Host <span style="color:#e6db74">&#34;Working on site </span>$($AD_Site.Name)<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Write-Host <span style="color:#e6db74">&#34;Checking if site </span>$($AD_Site.Name)<span style="color:#e6db74"> contains </span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    $DC_In_Site = $null
</span></span><span style="display:flex;"><span>    $DC_In_Site = Get-ADObject -Identity <span style="color:#e6db74">&#34;cn=</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">,cn=servers,</span>$($AD_Site.DistinguishedName)<span style="color:#e6db74">&#34;</span> -Partition <span style="color:#e6db74">&#34;CN=Configuration,</span>$($Forest_Domain.distinguishedName)<span style="color:#e6db74">&#34;</span> -Properties * -ErrorAction SilentlyContinue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">If</span> ($null <span style="color:#f92672">-ne</span> $DC_In_Site)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Site </span>$($AD_Site.Name)<span style="color:#e6db74"> contains </span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">&#34;</span> -ForegroundColor Cyan
</span></span><span style="display:flex;"><span>        $StandardOut = New-TemporaryFile
</span></span><span style="display:flex;"><span>        $ErrorOut = New-TemporaryFile
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Attempting to cleanup NTDS for </span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>        $NTDS = $null
</span></span><span style="display:flex;"><span>        $NTDS = Start-process -FilePath ntdsutil -argumentList <span style="color:#e6db74">&#34;&#34;&#34;metadata cleanup&#34;&#34; &#34;&#34;remove selected server cn=</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">,cn=servers,</span>$($AD_Site.DistinguishedName)<span style="color:#e6db74">&#34;&#34; q q&#34;</span> -wait -nonewwindow -RedirectStandardOutput $StandardOut.FullName -RedirectStandardError $ErrorOut -PassThru
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Get-Content -Path $StandardOut -Raw
</span></span><span style="display:flex;"><span>        Remove-Item -Path $StandardOut -Confirm:$false -Force
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">If</span> ($NTDS.ExitCode <span style="color:#f92672">-gt</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>            Get-Content -Path $ErrorOut -Raw
</span></span><span style="display:flex;"><span>            Remove-Item -Path $ErrorOut -Confirm:$false -Force
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">Throw</span> <span style="color:#e6db74">&#34;NTDS exit code was </span>$($NTDS.ExitCode)<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Cleaned up NTDS for </span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">&#34;</span> -ForegroundColor Green
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Attempting to cleanup site object for </span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>        $DC_In_Site = Get-ADObject -Identity <span style="color:#e6db74">&#34;cn=</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">,cn=servers,</span>$($AD_Site.DistinguishedName)<span style="color:#e6db74">&#34;</span> -Partition <span style="color:#e6db74">&#34;CN=Configuration,</span>$($Forest_Domain.distinguishedName)<span style="color:#e6db74">&#34;</span> -Properties *
</span></span><span style="display:flex;"><span>        $DC_In_Site | Remove-ADObject -Recursive -Confirm:$false
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Cleaned up site object for </span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">&#34;</span> -ForegroundColor Green
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Write-Host <span style="color:#e6db74">&#34;Attempting to cleanup other AD objects with this DC name&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>        $All_AD_Objects = Get-ADObject -Filter <span style="color:#e6db74">&#34;*&#34;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Foreach</span> ($AD_Object <span style="color:#66d9ef">in</span> $All_AD_Objects)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">If</span> ($AD_Object.DistinguishedName <span style="color:#f92672">-like</span> <span style="color:#e6db74">&#34;*</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">*&#34;</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                Write-Host <span style="color:#e6db74">&#34;Attempting to remove AD object </span>$($AD_Object.DistinguishedName)<span style="color:#e6db74">&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>                $AD_Object | Remove-ADObject -Recursive -Confirm:$false 
</span></span><span style="display:flex;"><span>                Write-Host <span style="color:#e6db74">&#34;Removed AD object </span>$($AD_Object.DistinguishedName)<span style="color:#e6db74">&#34;</span> -ForegroundColor Green
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span> All_AD_Sites
</span></span><span style="display:flex;"><span>        }    
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h2 id="cleanup-dns" data-numberify>Cleanup DNS<a class="anchor ms-1" href="#cleanup-dns"></a></h2>
<p>Now the last cleanup task I like to do is cleanup DNS.  You could let scavenging kick in if you&rsquo;d like, that&rsquo;s your call. For right now, I only scan the primary DNS zone for this DC.  If you have NS records else where.  You can borrow this to make it happen.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>Write-Host <span style="color:#e6db74">&#34;Cleanup DNS fore server </span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">&#34;</span> -ForegroundColor Cyan
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Foreach</span> ($Record <span style="color:#66d9ef">in</span> $All_DNS_Records)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Switch</span> ($Record.RecordType)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>        {$_ <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;A&#34;</span>} 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">If</span> ($Record.HostName <span style="color:#f92672">-like</span> <span style="color:#e6db74">&#34;*</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">*&#34;</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                Write-Host <span style="color:#e6db74">&#34;Removing DNS record&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>                $Record 
</span></span><span style="display:flex;"><span>                $Record | Remove-DnsServerResourceRecord -ZoneName $Domain.DNSRoot -ComputerName $($env:ComputerName) -Confirm:$false -Force
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ;<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        {$_ <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;CNAME&#34;</span>} 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">If</span> ($Record.recorddata.HostNameAlias <span style="color:#f92672">-like</span> <span style="color:#e6db74">&#34;*</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">*&#34;</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                Write-Host <span style="color:#e6db74">&#34;Removing DNS record&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>                $Record 
</span></span><span style="display:flex;"><span>                $Record | Remove-DnsServerResourceRecord -ZoneName $Domain.DNSRoot -ComputerName $($env:ComputerName) -Confirm:$false -Force
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ;<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        {$_ <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;SRV&#34;</span>} 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">If</span> ($Record.recorddata.DomainName <span style="color:#f92672">-like</span> <span style="color:#e6db74">&#34;*</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">*&#34;</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                Write-Host <span style="color:#e6db74">&#34;Removing DNS record&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>                $Record 
</span></span><span style="display:flex;"><span>                $Record | Remove-DnsServerResourceRecord -ZoneName $Domain.DNSRoot -ComputerName $($env:ComputerName) -Confirm:$false -Force
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ;<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        {$_ <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#34;NS&#34;</span>} <span style="color:#75715e">#Credit to @davidmi711 for his contribution to this.  </span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">If</span> ($Record.recorddata.DomainName <span style="color:#f92672">-like</span> <span style="color:#e6db74">&#34;*</span>$($AD_DC_Name_To_Remove)<span style="color:#e6db74">*&#34;</span>)
</span></span><span style="display:flex;"><span>                {
</span></span><span style="display:flex;"><span>                Write-Host <span style="color:#e6db74">&#34;Removing DNS record&#34;</span> -ForegroundColor Yellow
</span></span><span style="display:flex;"><span>                $Record 
</span></span><span style="display:flex;"><span>                $Record | Remove-DnsServerResourceRecord -ZoneName $Domain.DNSRoot -ComputerName $($env:ComputerName) -Confirm:$false -Force
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            ;<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div></div>
</div>
</div><div class="card-footer">
  <div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
      <i class="fas fa-fw fa-chevron-down post-prev-icon me-1" data-fa-transform="rotate-90"></i>
      <a href="/rdp-an-internal-error-has-occurred/">RDP: An internal error has occurred</a>
    </div><div class="post-nav post-next">
      <a href="/powershell-find-orphaned-disks-in-azure-and-their-cost/">PowerShell: Find orphaned disks in Azure and their cost</a>
      <i class="fas fa-fw fa-chevron-down post-next-icon ms-1" data-fa-transform="rotate-270"></i>
    </div></div>
</div></article><div class="post-copyright mb-3 row card component" id="post-copyright">
    <div class="card-header">
        <h2 class="card-title fs-4 my-2 text-surface">Copyright</h2>
    </div>
    <div class="card-body"><a class="d-flex align-items-center flex-column" target="_blank" rel="license noopener noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">
  <span><i class="fab fa-fw fa-2x fa-creative-commons"></i><i class="fab fa-fw fa-2x fa-creative-commons-by"></i><i class="fab fa-fw fa-2x fa-creative-commons-sa"></i></span>
  CC BY-SA 4.0 
</a>


    </div>
</div><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title my-2 fs-4 text-surface">Comments</h2>
  </div>
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="ericcsinger/ericcsinger.github.io"
  issue-term="title"
  label="comment"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>



</div>
</div></div>
</div>
<aside class="col-xxl-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    
<div class="accordion profile">
  <div class="accordion-item card row text-center component">
    <div class="accordion-header card-header border-0" id="profile-header">
      <a
        class="accordion-button d-lg-none mb-2 shadow-none p-0 bg-transparent text-surface"
        role="button" data-bs-toggle="collapse" href="#profile" aria-expanded="true" aria-controls="profile">
        Profile
      </a>
    </div>
    <div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id="profile" aria-labelledby="profile-header">
      <div class="col-12 d-flex align-items-center justify-content-center"><picture><img class="profile-avatar rounded-circle " alt="Eric C. Singer" src="https://ericcsinger.com/about/headshot.webp" loading="lazy" data-viewer-invisible width="2316" height="3088" />
</picture>
</div>
      <div class="col-12 profile-meta"><div class="profile-name fw-fold fs-lg">Eric C. Singer</div><div class="profile-bio">An enthusiastic IT professional, focused on architecting and automating infrastructure since 2002.</div><div class="profile-location"><i class="fas fa-fw fa-map-marker-alt"></i>Quakertown, PA</div><a class="profile-about text-primary" href="/about/"><i class="fas fa-fw fa-user"></i>About Me</a></div>


<nav class="social-links nav justify-content-center mt-1 justify-content-around">
      <a class="nav-link social-link" target="_blank" href="https://github.com/ericcsinger" title="GitHub" rel="me">
        <i class="fa-fw fa-2x fab fa-github"
          ></i>
      </a>
      <a class="nav-link social-link" target="_blank" href="https://linkedin.com/in/ericcsinger" title="LinkedIn" rel="me">
        <i class="fa-fw fa-2x fab fa-linkedin-in"
           style="color: #0a66c2;"></i>
      </a>
      <a class="nav-link social-link" target="_blank" href="https://stackoverflow.com/users/1239030" title="Stack Overflow" rel="me">
        <i class="fa-fw fa-2x fab fa-stack-overflow"
           style="color: #f48024;"></i>
      </a>
      <a class="nav-link social-link" target="_blank" href="https://twitter.com/esinger" title="Twitter" rel="me">
        <i class="fa-fw fa-2x fab fa-twitter"
           style="color: #1d9bf0;"></i>
      </a>
  <a class="nav-link social-link" target="_blank" href="/index.xml" title="RSS" rel="me">
    <i class="fas fa-fw fa-2x fa-rss" style="color: #ea6221;"></i>
  </a>
</nav>
</div>
  </div>
</div>


<div class="accordion taxonomies-toggle">
    <div class="row card component accordion-item">
        <div class="accordion-header card-header border-0">
            <a
                class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent"
                role="button" data-bs-toggle="collapse" href="#taxonomies-toggle" aria-expanded="true" aria-controls="taxonomies-toggle">
                Taxonomies
            </a>
        </div>
        <div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id="taxonomies-toggle">
            <ul class="nav nav-pills nav-fill" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="taxonomyTagsTab" data-bs-toggle="tab" data-bs-target="#taxonomyTags" 
                            type="button" role="tab" aria-controls="taxonomyTags" aria-selected="true">
                            Tags
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="taxonomyCategoriesTab" data-bs-toggle="tab" data-bs-target="#taxonomyCategories" 
                            type="button" role="tab" aria-controls="taxonomyCategories" aria-selected="true">
                            Categories
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="taxonomySeriesTab" data-bs-toggle="tab" data-bs-target="#taxonomySeries" 
                            type="button" role="tab" aria-controls="taxonomySeries" aria-selected="true">
                            Series
                        </button>
                    </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="taxonomyArchivesTab" data-bs-toggle="tab" data-bs-target="#taxonomyArchives" 
                        type="button" role="tab" aria-controls="taxonomyArchives" aria-selected="true">
                        Archives
                    </button>
                </li>
            </ul>
            
            <div class="tab-content mt-3">
                    <div class="tab-pane active" id="taxonomyTags" role="tabpanel" aria-labelledby="taxonomyTagsTab" tabindex="0">
                        <a href="/tags/powershell/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="powershell">
                            powershell
                            <span class="badge badge-sm text-secondary bg-white ms-1">18</span>
                        </a>
                        <a href="/tags/azure/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Azure">
                            Azure
                            <span class="badge badge-sm text-secondary bg-white ms-1">8</span>
                        </a>
                        <a href="/tags/microsoft/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Microsoft">
                            Microsoft
                            <span class="badge badge-sm text-secondary bg-white ms-1">8</span>
                        </a>
                        <a href="/tags/automation/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="automation">
                            automation
                            <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
                        </a>
                        <a href="/tags/backup/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="backup">
                            backup
                            <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
                        </a>
                        <a href="/tags/sql/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="SQL">
                            SQL
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="storage">
                            storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/vmware/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="vmware">
                            vmware
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/wsus/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="wsus">
                            wsus
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/arm/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="arm">
                            arm
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/bicep/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="bicep">
                            bicep
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/iac/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="IaC">
                            IaC
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/thinking-out-loud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="thinking out loud">
                            thinking out loud
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/naming-conventions/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="naming conventions">
                            naming conventions
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/tags/review/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="review">
                            review
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/tags/windows/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="windows">
                            windows
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/tags/commvault/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="commvault">
                            commvault
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/jams/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="JAMS">
                            JAMS
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/nimble-storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="nimble storage">
                            nimble storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/reviews/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="reviews">
                            reviews
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/scripting/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="scripting">
                            scripting
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/t-sql/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="T-SQL">
                            T-SQL
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/active-directory/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="active directory">
                            active directory
                            <span class="badge badge-sm text-secondary bg-white ms-1">2</span>
                        </a>
                        <a href="/tags/centralized-job-management/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="centralized job management">
                            centralized job management
                            <span class="badge badge-sm text-secondary bg-white ms-1">2</span>
                        </a>
                        <a href="/tags/cloud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="cloud">
                            cloud
                            <span class="badge badge-sm text-secondary bg-white ms-1">2</span>
                        </a>
                        <a href="https://ericcsinger.com/tags" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title='ALL'>
                        ALL
                        <span class="badge badge-sm text-secondary bg-white ms-1">61</span>
                        </a>
                    </div>
                    <div class="tab-pane" id="taxonomyCategories" role="tabpanel" aria-labelledby="taxonomyCategoriesTab" tabindex="0">
                        <a href="/categories/uncategorized/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Uncategorized">
                            Uncategorized
                            <span class="badge badge-sm text-secondary bg-white ms-1">48</span>
                        </a>
                        <a href="/categories/backup/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Backup">
                            Backup
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/categories/storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Storage">
                            Storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/categories/thinking-out-loud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="thinking out loud">
                            thinking out loud
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/categories/naming-conventions/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="naming conventions">
                            naming conventions
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/categories/cloud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="cloud">
                            cloud
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                        <a href="/categories/licensing/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="licensing">
                            licensing
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                        <a href="/categories/monitoring/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="monitoring">
                            monitoring
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                        <a href="/categories/servers/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="servers">
                            servers
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                    </div>
                    <div class="tab-pane" id="taxonomySeries" role="tabpanel" aria-labelledby="taxonomySeriesTab" tabindex="0">
                        <a href="/series/backup-storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Backup Storage">
                            Backup Storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">8</span>
                        </a>
                        <a href="/series/azure-bicep-conditional-properties/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Azure Bicep Conditional Properties">
                            Azure Bicep Conditional Properties
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                    </div>
                <div class="tab-pane" id="taxonomyArchives" role="tabpanel" aria-labelledby="taxonomyArchivesTab" tabindex="0">

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2022">
    2022 <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2021">
    2021 <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2020">
    2020 <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2019">
    2019 <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2018">
    2018 <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2017">
    2017 <span class="badge badge-sm text-secondary bg-white ms-1">17</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2016">
    2016 <span class="badge badge-sm text-secondary bg-white ms-1">17</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2015">
    2015 <span class="badge badge-sm text-secondary bg-white ms-1">16</span>
    </a>


                </div>
            </div>
        </div>
    </div>
</div>
    <div class="accordion posts-toggle">
      <div class="row card component accordion-item">
        <div class="accordion-header card-header border-0">
          <a
            class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent"
            role="button"
            data-bs-toggle="collapse"
            href="#posts-toggle"
            aria-expanded="true"
            aria-controls="posts-toggle">
            Posts
          </a>
        </div>
        <div
          class="card-body collapse accordion-collapse accordion-body d-lg-block show"
          id="posts-toggle">
          <ul class="nav nav-pills nav-fill" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="recent-posts-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#recent-posts"
                  type="button"
                  role="tab"
                  aria-controls="recent-posts"
                  aria-selected="true">
                  Recent Posts
                </button>
              </li>
          </ul>

          <div class="tab-content mt-3">
              <div
                class="tab-pane active"
                id="recent-posts"
                role="tabpanel"
                aria-labelledby="recent-posts-tab"
                tabindex="0">
                <ul class="post-list list-unstyled ms-1">
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/naming-conventions-azure-locations/">
        Naming Conventions: Azure Locations
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sun, 30 Oct 2022 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/problem-solving-windows-dns-server-in-azure-returns-servfail/">
        Problem Solving: Windows DNS Server in Azure returns SERVFAIL
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sat, 24 Sep 2022 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/azure-bicep-conditional-properties-part-04-helper-modules/">
        Azure Bicep Conditional Properties Part 04, Helper Modules
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sat, 10 Sep 2022 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/azure-bicep-conditional-properties-part-03-template-variables/">
        Azure Bicep Conditional Properties Part 03, Template Variables
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sun, 28 Aug 2022 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/azure-bicep-conditional-properties-part-02-parameters/">
        Azure Bicep Conditional Properties Part 02, Parameters
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sun, 21 Aug 2022 13:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                </ul>
              </div>
          </div>
        </div>
      </div>
    </div>
<div class="accordion post-toc d-none d-lg-block">
  <div class="accordion-item row mb-4 card component" id="postTOC">
    <div class="card-header accordion-header">
      <h2 class="card-title fs-4 my-2 text-surface d-none d-lg-block">Contents</h2>
      <a class="accordion-button d-lg-none mb-1 collapsed shadow-none p-0 bg-transparent" role="button" data-bs-toggle="collapse" href="#post-toc" aria-expanded="false" aria-controls="post-toc">
        Contents
      </a>
    </div>
    <div class="card-body collapse accordion-collapse accordion-body d-lg-block" id="post-toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction:</a></li>
    <li><a href="#parameters">Parameters</a></li>
    <li><a href="#getting-some-preliminary-domain-and-forest-information">Getting some preliminary domain and forest information</a></li>
    <li><a href="#sieze-them">Sieze Them!</a></li>
    <li><a href="#cleanup-our-sites-and-ntds">Cleanup our sites and NTDS</a></li>
    <li><a href="#cleanup-dns">Cleanup DNS</a></li>
  </ul>
</nav>
    </div>
  </div>
</div>





    
  </div>
</aside>

      </div>
    </main><footer class="footer mt-auto py-3 text-center container"><div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="offcanvasActionsPanel"
  aria-labelledby="offcanvasActionsPanelLabel">
  <div class="offcanvas-header">
    <div class="offcanvas-title h5" id="offcanvasActionsPanelLabel">
      <i class="fas fa-fw fa-th-large me-1"></i>
      Actions
    </div>
    <button type="button" class="btn-close ms-auto" data-bs-dismiss="offcanvas" data-bs-target="offcanvasActionsPanel" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body mt-2"><div class="social-share mb-4 d-flex overflow-auto">
      <a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=VMware%20vSAN%20in%20my%20environment%3f%20not%20yet%21&url=https%3a%2f%2fericcsinger.com%2fvmware-vsan-in-my-environment-not-yet%2f">
        <i class="fab fa-2x fa-fw fa-twitter mb-2"></i> Twitter
      </a>
      <a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Facebook Share Button"
        target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fericcsinger.com%2fvmware-vsan-in-my-environment-not-yet%2f">
        <i class="fab fa-2x fa-fw fa-facebook-f mb-2"></i> Facebook
      </a>
    </div>
    <hr class="mb-4"><div class="actions d-flex overflow-auto align-items-center">
      <a role="button" class="action action-go-back d-flex flex-column align-items-center me-3" href="javascript: window.history.back();">
        <span class="action-icon mb-2"><i class="fas fa-2x fa-chevron-circle-down" data-fa-transform="rotate-90"></i></span> Go back
      </a>
      <a role="button" class="action action-reload-page d-flex flex-column align-items-center me-3">
        <span class="action-icon mb-2"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
      </a>
      <a role="button" class="action action-copy-url d-flex flex-column align-items-center me-3">
        <span class="action-icon mb-2"><i class="fas fa-2x fa-link"></i></span> Copy URL
      </a>
    </div>
  </div>
</div><div class="row text-center">
  <div class="col-12 mt-2">
    <p class="mb-2">Eric&#39;s Blog</p>
    <p class="text-secondary mb-2"><small>Eric IT Blog</small></p><div class="copyright mb-2 text-secondary">
  <small>©2023, Eric C. Singer
</small>
</div>
<div class="powered-by mb-2 text-secondary">
  <small>
    Build with ❤️ from the <a class="text-primary" href="https://gohugo.io" target="_blank" rel="noopener noreferrer">Hugo</a> and the <a class="text-primary" href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank" rel="noopener noreferrer">HBS</a> theme.
  </small>
</div>


<nav class="social-links nav justify-content-center mb-2 mt-3">
  <a class="nav-link social-link p-0 me-1 mb-2" target="_blank" href="/index.xml" title="RSS" rel="me">
    <i class="fas fa-fw fa-2x fa-rss" style="color: #ea6221;"></i>
  </a>
</nav>
</div>
  <div class="col-12 col-lg-8 offset-0 offset-lg-1"></div>
</div>
</footer>
<script data-precache src="/assets/main/bundle.min.88a3da4211215658c019105ee6df6d39dcbcc5df9c304d0005643346b9f64cb9.js" integrity="sha256-iKPaQhEhVljAGRBe5t9tOdy8xd&#43;cME0ABWQzRrn2TLk=" crossorigin="anonymous" async></script><script data-precache src="/assets/icons/bundle.min.691458a56c2eef480bec8d31c967801a416b6445459ae901fe213e7870a0dd83.js" integrity="sha256-aRRYpWwu70gL7I0xyWeAGkFrZEVFmukB/iE&#43;eHCg3YM=" crossorigin="anonymous" defer></script>
<script data-precache src="/assets/viewer/bundle.min.9ba76665e3c9fa036c059c1c85f287b5780b8c3e27f6cc9cd6372b90c42cf347.js" integrity="sha256-m6dmZePJ&#43;gNsBZwchfKHtXgLjD4n9syc1jcrkMQs80c=" crossorigin="anonymous" defer></script>
  <script data-precache defer src="/assets/katex/bundle.min.b0348f9dd3c40eee23b65b205b879d1bed2136c80586689e7a50745d8f89d849.js" integrity="sha256-sDSPndPEDu4jtlsgW4edG&#43;0hNsgFhmieelB0XY&#43;J2Ek=" crossorigin="anonymous"></script>



  </body>
</html>
