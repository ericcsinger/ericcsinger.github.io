<!doctype html>
<html class="position-relative" itemscope itemtype="https://schema.org/WebPage" lang="en"
  data-bs-theme="auto" data-palette="blue">
  <head><script src="/assets/init/bundle.min.2232e70cd03e25718136e7eb51d0b7aac3fb2a2161c5553fb49ad1dfdc9881e0.js" integrity="sha256-IjLnDNA&#43;JXGBNufrUdC3qsP7KiFhxVU/tJrR39yYgeA=" crossorigin="anonymous"></script>
<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Problem Solving: Windows DNS Server in Azure returns SERVFAIL - Eric&#39;s Blog</title>
    <link rel="icon" href="/favicon_hu_e83888ddb6472856.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/favicon_hu_276a61518911b273.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/favicon_hu_1fce3f16494f6ae3.png" sizes="150x150" type="image/png">
    <link rel="apple-touch-icon" href="/favicon_hu_f105fae78c239d0f.png" sizes="180x180" type="image/png">
    <link rel="icon" href="/favicon_hu_af357fe99fc0195a.png" sizes="192x192" type="image/png">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#6f42c1">
<meta name="keywords" content="dns, SERVFAIL, windows, azure, forwarder, microsoft, 168.63.129.16, timeout" />
  <meta name="description" content="Introduction
I had been troubleshooting a fairly tricky DNS resolution issue and wanted to share what I learned with all of you.  Most of the DNS lookup issues I&rsquo;ve encountered in my career, have been the result of a misconfigured zone, record, or a server outage.  I cannot recall a time with a Windows DNS server, where I&rsquo;ve had to adjust default setting, but that&rsquo;s exactly what I&rsquo;ve had to do." />
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Problem Solving: Windows DNS Server in Azure returns SERVFAIL">
  <meta name="twitter:description" content="Introduction I had been troubleshooting a fairly tricky DNS resolution issue and wanted to share what I learned with all of you. Most of the DNS lookup issues I’ve encountered in my career, have been the result of a misconfigured zone, record, or a server outage. I cannot recall a time with a Windows DNS server, where I’ve had to adjust default setting, but that’s exactly what I’ve had to do.">
      <meta name="twitter:site" content="@esinger">
<meta property="og:url" content="https://ericcsinger.com/problem-solving-windows-dns-server-in-azure-returns-servfail/">
  <meta property="og:site_name" content="Eric&#39;s Blog">
  <meta property="og:title" content="Problem Solving: Windows DNS Server in Azure returns SERVFAIL">
  <meta property="og:description" content="Introduction I had been troubleshooting a fairly tricky DNS resolution issue and wanted to share what I learned with all of you. Most of the DNS lookup issues I’ve encountered in my career, have been the result of a misconfigured zone, record, or a server outage. I cannot recall a time with a Windows DNS server, where I’ve had to adjust default setting, but that’s exactly what I’ve had to do.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-09-24T12:00:00+00:00">
    <meta property="article:modified_time" content="2022-09-24T12:00:00+00:00">
    <meta property="article:tag" content="Dns">
    <meta property="article:tag" content="Azure">
    <meta property="article:tag" content="Microsoft">

  <meta itemprop="name" content="Problem Solving: Windows DNS Server in Azure returns SERVFAIL">
  <meta itemprop="description" content="Introduction I had been troubleshooting a fairly tricky DNS resolution issue and wanted to share what I learned with all of you. Most of the DNS lookup issues I’ve encountered in my career, have been the result of a misconfigured zone, record, or a server outage. I cannot recall a time with a Windows DNS server, where I’ve had to adjust default setting, but that’s exactly what I’ve had to do.">
  <meta itemprop="datePublished" content="2022-09-24T12:00:00+00:00">
  <meta itemprop="dateModified" content="2022-09-24T12:00:00+00:00">
  <meta itemprop="wordCount" content="1911">
  <meta itemprop="keywords" content="dns,SERVFAIL,windows,azure,forwarder,microsoft,168.63.129.16,timeout">

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-B4G7NX7JV6"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-B4G7NX7JV6');
        }
      </script>
<link data-precache rel="stylesheet" href="/assets/main/bundle.min.356a9760bdbac40681ce47a16bc4b7f78053a86b772594c63870d4face095fc0.css" integrity="sha256-NWqXYL26xAaBzkeha8S394BTqGt3JZTGOHDU+s4JX8A=" crossorigin="anonymous">

<link data-precache rel="stylesheet" href="/assets/katex/bundle.min.b556ec958bd1c02e7341a64d31ec7c9cd88375ba59b282a7df7b7ff99901ccd2.css" integrity="sha256-tVbslYvRwC5zQaZNMex8nNiDdbpZsoKn33t/&#43;ZkBzNI=" crossorigin="anonymous">

    <link data-precache rel="stylesheet" href="/assets/viewer/bundle.min.8c1002839fa22c1350d6ae1eef6593120e108f973c41348be9b5065430566aaf.css" integrity="sha256-jBACg5&#43;iLBNQ1q4e72WTEg4Qj5c8QTSL6bUGVDBWaq8=" crossorigin="anonymous">


</head>
  <body><header class="mb-4 sticky-top">
  
<nav class="top-app-bar shadow navbar navbar-expand-xxl">
  <div class="container">
<a class="navbar-brand d-flex align-items-center flex-grow-1 flex-xxl-grow-0 justify-content-xxl-start ms-2 ms-xxl-0 mx-auto me-xxl-2"
    href="https://ericcsinger.com/">Eric&#39;s Blog
</a>

    <div class="offcanvas-xxl offcanvas-end flex-grow-1" data-bs-scroll="true" tabindex="-1" id="navbarMenus" aria-labelledby="navbarMenusLabel">
      <div class="offcanvas-header px-4 pb-0">
        <div class="offcanvas-title h5" id="navbarMenusLabel">Eric&#39;s Blog</div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" data-bs-target="#navbarMenus" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body p-4 pt-0 p-xxl-0">
        <hr class="d-xxl-none">
        <ul class="navbar-nav flex-row flex-wrap align-items-center me-auto"><li class="nav-item col-6 col-xxl-auto">
            <a class="nav-link py-2 px-0 px-xxl-2" href="https://ericcsinger.com/about/">About
            </a>
          </li>
        </ul>
        
    <hr class="d-xxl-none">
    <form class="search-bar ms-auto my-auto" action="" novalidate>
      <div class="input-group align-items-center">
        <span class="btn btn-search disabled position-absolute left-0 border-0 px-1">
          <i class="fas fa-fw fa-search fa-lg"></i>
        </span>
        <input
          class="my-1 form-control border-white rounded-5 search-input bg-body"
          name="q"
          type="search"
          placeholder="Search"
          aria-label="Search"
          required>
          <span class="search-shortcut position-absolute end-0 top-0 me-2">
            <kbd class="text-dark bg-white opacity-75 rounded-3 shadow border border-primary py-1 fw-bold">/</kbd>
          </span>
      </div>
    </form><hr class="d-xxl-none">
        <ul class="navbar-nav flex-row flex-wrap align-items-center ms-md-auto">
<li class="nav-item dropdown col-6 col-xxl-auto">
    <a class="nav-link px-0 py-2 px-xxl-1" href="#" id="paletteDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-fw fa-palette"></i>
        <span class="d-xxl-none">Palette</span>
    </a>
    <ul class="palette-dropdown-menu dropdown-menu dropdown-menu-end px-2 row g-2" aria-labelledby="paletteDropdown">
            <li class="col-4 my-1">
                <a role="button" id="palette-blue" aria-label="Blue"
                    class="btn btn-sm w-100 palette text-bg-blue" data-palette="blue">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-blue-gray" aria-label="Blue Gray"
                    class="btn btn-sm w-100 palette text-bg-blue-gray" data-palette="blue-gray">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-brown" aria-label="Brown"
                    class="btn btn-sm w-100 palette text-bg-brown" data-palette="brown">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-cyan" aria-label="Cyan"
                    class="btn btn-sm w-100 palette text-bg-cyan" data-palette="cyan">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-green" aria-label="Green"
                    class="btn btn-sm w-100 palette text-bg-green" data-palette="green">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-indigo" aria-label="Indigo"
                    class="btn btn-sm w-100 palette text-bg-indigo" data-palette="indigo">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-orange" aria-label="Orange"
                    class="btn btn-sm w-100 palette text-bg-orange" data-palette="orange">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-pink" aria-label="Pink"
                    class="btn btn-sm w-100 palette text-bg-pink" data-palette="pink">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-purple" aria-label="Purple"
                    class="btn btn-sm w-100 palette text-bg-purple" data-palette="purple">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-red" aria-label="Red"
                    class="btn btn-sm w-100 palette text-bg-red" data-palette="red">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-teal" aria-label="Teal"
                    class="btn btn-sm w-100 palette text-bg-teal" data-palette="teal">
                </a>
            </li>
            <li class="col-4 my-1">
                <a role="button" id="palette-yellow" aria-label="Yellow"
                    class="btn btn-sm w-100 palette text-bg-yellow" data-palette="yellow">
                </a>
            </li>
    </ul>
</li>
<li class="nav-item dropdown col-6 col-xxl-auto">
    <a class="nav-link px-0 py-2 px-xxl-1" href="#" id="modeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="mode-icon fas fa-fw fa-adjust" id="modeIcon"></i>
        <span class="d-xxl-none">Mode</span>
    </a>
    <ul class="mode-dropdown-menu dropdown-menu dropdown-menu-end" aria-labelledby="modeDropdown">
        <li class="mode-item" data-color-mode="light" data-icon="sun">
            <button class="dropdown-item">
                <i class="mode-icon fas fa-fw fa-sun"></i> Light
            </button>
        </li>
        <li class="mode-item" data-color-mode="dark" data-icon="moon">
            <button class="dropdown-item">
                <i class="mode-icon fas fa-fw fa-moon"></i> Dark
            </button>
        </li>
        <li class="mode-item active" data-color-mode="auto" data-icon="adjust">
            <button class="dropdown-item">
                <i class="mode-icon fas fa-fw fa-adjust"></i> Auto
            </button>
        </li>
    </ul>
</li>
        </ul>
      </div>
    </div>
    <div class="d-flex">
      <button class="navbar-toggler order-5 border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#navbarMenus"
        aria-controls="navbarMenus" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-ellipsis-h"></i>
      </button>
    </div>
  </div>
</nav>

</header>

    <main class="container has-sidebar" data-kind="page"><script data-precache src="/js/main-init.6eaf083f43f73eb9a5e7053a7319f846fc45da423be9e1e17cd536403c4e5c9c.js" integrity="sha256-bq8IP0P3Prml5wU6cxn4RvxF2kI76eHhfNU2QDxOXJw=" crossorigin="anonymous"></script>

      <div class="row content"><noscript>
    <div class="alert alert-danger" role="alert">Your browser does not support JavaScript.</div>
</noscript>

<div class="content-posts col-xxl-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body pb-0">
    <ol class="hbs-breadcrumb breadcrumb flex-nowrap"><li class="breadcrumb-item text-surface"><a href="/">Home</a></li><li class="breadcrumb-item text-surface"><a href="/posts/">Posts</a></li><li class="breadcrumb-item active">Problem Solving: Windows DNS Server in Azure returns SERVFAIL</li></ol>
  </div>
</nav><div class="post-panel-wrapper position-relative d-flex justify-content-center">
  <div class="d-flex flex-row justify-content-center rounded-5 border post-panel position-fixed px-3 py-1 surface shadow-1">
    
    

    
    
    
  <a class="action action-toc d-none d-xxl-block" href="#postTOC" role="button" title="Contents">
    <i class="fas fa-fw fa-list-alt"></i>
  </a>
<a class="action action-toc d-block d-xxl-none" href="#post-toc-container" role="button" title="Contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    <a class="action action-copyright" href="#post-copyright" role="button" aria-label="Copyright" title="Copyright">
  <i class="fas fa-fw fa-copyright"></i>
</a>
    <a class="action action-post-comments" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    
<a id="sidebarToggler" class="action action-sidebar-toggler d-none d-xxl-block" role="button" title="Toggle sidebar">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    
  </div>
</div><article class="row card component mb-4 post">
  <div class="card-header ">
    <h1 class="card-title post-title my-2">Problem Solving: Windows DNS Server in Azure returns SERVFAIL</h1>
  </div>
  <div class="card-body"><div class="post-meta mb-3">
  <span class="post-date me-1 mb-1" title="created on 2022-09-24 08:00:00 -0400 EDT.">Sat, 24 Sep 2022 12:00:00 &#43;0000</span><span class="post-reading-time me-1 mb-1">9 min read</span><a href="/tags/azure/" class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Azure</a><a href="/tags/dns/" class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Dns</a><a href="/tags/microsoft/" class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-taxonomy-sm post-tag">Microsoft</a>
</div>

<div class="mt-2 mb-3 d-block d-xxl-none">
    <h2 class="text-surface mb-3">Contents</h2>
    <div id="post-toc-container">
        </div>
    <hr class="text-secondary">
</div><div class="post-content mb-3" data-bs-spy="scroll" data-bs-target="#TableOfContents" tabindex="0">
        <div id="post-content-body">
<h2 id="introduction" data-numberify>Introduction<a class="anchor ms-1" href="#introduction"></a></h2>
<p>I had been troubleshooting a fairly tricky DNS resolution issue and wanted to share what I learned with all of you.  Most of the DNS lookup issues I&rsquo;ve encountered in my career, have been the result of a misconfigured zone, record, or a server outage.  I cannot recall a time with a Windows DNS server, where I&rsquo;ve had to adjust default setting, but that&rsquo;s exactly what I&rsquo;ve had to do.</p>
<p>In this article, I will walk you through the following areas.</p>
<ul>
<li>What our DNS resolution path looked like before</li>
<li>Describing the problem I ran into.</li>
<li>Setting up the diagnostics to capture the problem</li>
<li>Research I did to understand what was going on</li>
<li>How I solved it</li>
<li>General recommendations</li>
</ul>

<h2 id="dns-setup" data-numberify>DNS Setup<a class="anchor ms-1" href="#dns-setup"></a></h2>
<p>Our server looks pretty straight forward.  Keep in mind, the purpose of this Windows DNS server, was to provide DNS resolution for domain joined VM&rsquo;s.  Up until very recently, Azure had no native means to forward DNS requests to a domain controller.  This forced you to either statically set DNS servers on your Azure VM ipConfiguration, or update the whole virtual network to forward DNS requests to a Windows DNS server.  As of this writing, there is a new preview feature called <a href="https://learn.microsoft.com/en-us/azure/dns/dns-private-resolver-overview" target="_blank" rel="noopener noreferrer">Azure DNS Private Resolver<i class="fas fa-external-link-square-alt ms-1"></i></a> which looks to mitigate the need for this setup.  It&rsquo;s something I&rsquo;ll be exploring once it&rsquo;s out of preview.</p>
<pre class="mermaid">

graph LR
    DNSClient((DNS Client))

    subgraph Windows DNS Server
        dnsServerIp[DNS Server IP]

        subgraph DNS Forwarders
            azureDNS[Azure DNS]
            end

        subgraph Conditional Forwarder Active Directory Domain
            DC1[Domain Controller 1 IP]
            DC2[Domain Controller 2 IP]
            end   
        end

    externalDNSServer[External DNS Server / Azure]
    adServers[Active Directory DNS Lookup]

    DNSClient --Lookup-->dnsServerIp
    dnsServerIp --Unknown Lookup-->azureDNS--Lookup external name server -->externalDNSServer
    dnsServerIp --AD Lookup-->DC1 & DC2 --Lookup Domain DNS--> adServers

</pre>


<h2 id="discovering-and-understanding-the-problem" data-numberify>Discovering and understanding the problem<a class="anchor ms-1" href="#discovering-and-understanding-the-problem"></a></h2>
<p>There were two primary ways we discovered this issue.</p>
<ol>
<li>Azure Insights informed us that our apps were throwing an exception.</li>
<li>Our proactive web health check would also inform us that one of our sites was intermittently offline.</li>
</ol>
<p>An example of the errors we would see in both tools, are below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>The remote name could not be resolved: &#39;record.domain.com&#39; 
</span></span><span style="display:flex;"><span>The remote name could not be resolved: &#39;record2.domain.com&#39;
</span></span></code></pre></div><p>While the error was pretty self explanatory, we were never able to reproduce it.  Typically, the errors were only blips, lasting a few seconds and then returning to healthy.  This made the issue incredibly difficult to troubleshoot.</p>

<h2 id="diagnostics" data-numberify>Diagnostics<a class="anchor ms-1" href="#diagnostics"></a></h2>
<p>Fortunately, we were using Windows DNS.  One of the good things about running your own infrastructure, is you have the ability to see what&rsquo;s going on.  I knew Windows DNS had some pretty verbose logging capabilities, so that&rsquo;s what I enabled.  You can see the diagnostic settings I enabled via PowerShell.  I have almost every option enabled.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Get-DnsServerDiagnostics
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SaveLogsToPersistentStorage          : False
</span></span><span style="display:flex;"><span>Queries                              : True
</span></span><span style="display:flex;"><span>Answers                              : True
</span></span><span style="display:flex;"><span>Notifications                        : True
</span></span><span style="display:flex;"><span>Update                               : True
</span></span><span style="display:flex;"><span>QuestionTransactions                 : True
</span></span><span style="display:flex;"><span>UnmatchedResponse                    : True
</span></span><span style="display:flex;"><span>SendPackets                          : True
</span></span><span style="display:flex;"><span>ReceivePackets                       : True
</span></span><span style="display:flex;"><span>TcpPackets                           : True
</span></span><span style="display:flex;"><span>UdpPackets                           : True
</span></span><span style="display:flex;"><span>FullPackets                          : True
</span></span><span style="display:flex;"><span>FilterIPAddressList                  : 
</span></span><span style="display:flex;"><span>EventLogLevel                        : 7
</span></span><span style="display:flex;"><span>UseSystemEventLog                    : False
</span></span><span style="display:flex;"><span>EnableLoggingToFile                  : True
</span></span><span style="display:flex;"><span>EnableLogFileRollover                : False
</span></span><span style="display:flex;"><span>LogFilePath                          : C:\DNS\debug.txt
</span></span><span style="display:flex;"><span>MaxMBFileSize                        : 500000000
</span></span><span style="display:flex;"><span>WriteThrough                         : False
</span></span><span style="display:flex;"><span>EnableLoggingForLocalLookupEvent     : False
</span></span><span style="display:flex;"><span>EnableLoggingForPluginDllEvent       : False
</span></span><span style="display:flex;"><span>EnableLoggingForRecursiveLookupEvent : True
</span></span><span style="display:flex;"><span>EnableLoggingForRemoteServerEvent    : True
</span></span><span style="display:flex;"><span>EnableLoggingForServerStartStopEvent : False
</span></span><span style="display:flex;"><span>EnableLoggingForTombstoneEvent       : False
</span></span><span style="display:flex;"><span>EnableLoggingForZoneDataWriteEvent   : False
</span></span><span style="display:flex;"><span>EnableLoggingForZoneLoadingEvent     : False
</span></span></code></pre></div>
<h3 id="diagnostic-results" data-numberify>Diagnostic Results<a class="anchor ms-1" href="#diagnostic-results"></a></h3>
<p>Once I saw the error occur again, I <em>gleefully</em> started combing the logs.  I was really hopeful it would be something simple / straight forward.  Alas, the logs did not paint a picture that was easy to understand.  Looking back with the information I&rsquo;ll share further down.  All the answers were there, I just didn&rsquo;t understand it at the time.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>9/13/2022 5:00:01 PM 02EC PACKET  0000015D4AE3B560 UDP Rcv redactedIpAddress        2d20   Q [0001   D   NOERROR] A      (5)record(16)domain(3)com(0)
</span></span><span style="display:flex;"><span>9/13/2022 5:00:01 PM 02EC PACKET  0000015D4B368D80 UDP Snd 168.63.129.16            bd32   Q [0001   D   NOERROR] A      (5)record(16)domain(3)com(0)
</span></span><span style="display:flex;"><span>9/13/2022 5:00:01 PM 02EC PACKET  0000015D4A022070 UDP Rcv redactedIpAddress        2d20   Q [0001   D   NOERROR] A      (5)record(16)domain(3)com(0)
</span></span><span style="display:flex;"><span>9/13/2022 5:00:02 PM 02EC PACKET  0000015D4CFA9570 UDP Rcv redactedIpAddress        2d20   Q [0001   D   NOERROR] A      (5)record(16)domain(3)com(0)
</span></span><span style="display:flex;"><span>9/13/2022 5:00:04 PM 02EC PACKET  0000015D4B0D7990 UDP Rcv redactedIpAddress        2d20   Q [0001   D   NOERROR] A      (5)record(16)domain(3)com(0)
</span></span><span style="display:flex;"><span>9/13/2022 5:00:05 PM 179C PACKET  0000015D4AE3B560 UDP Snd redactedIpAddress        2d20 R Q [8281   DR SERVFAIL] A      (5)record(16)domain(3)com(0)
</span></span><span style="display:flex;"><span>9/13/2022 5:00:05 PM 02EC PACKET  0000015D4CF40C80 UDP Rcv 168.63.129.16            bd32 R Q [8081   DR  NOERROR] A      (5)record(16)domain(3)com(0)
</span></span></code></pre></div><p>Searching &ldquo;DNS SERVFAIL&rdquo; and many other combinations of texts didn&rsquo;t provide a ton of helpful information.  Most of the errors simply stated the authoritative DNS server was having issues.  In this case, while it would have been easy to say &ldquo;must be the authoritative server having issues&rdquo;, I had no proof of it per se.  Part of the issue, is the DNS request is forwarded to Azure, which leaves me blind for part of the resolution path.</p>
<p>Over the course of a week or so, I thought maybe it was related to Azure, so I started playing around with different forwarders.  First I sent it to Google and CloudFlare.  Same issue occurred, so it <strong>had</strong> to be on the authoritative server right?  We were not dealing with recursion yet (this particular record would ultimately need to be recursed), but this was failing on the first lookup.</p>
<p>I started suspecting there might be some timeout issue or some sort of throttling going on.  After tracking down the Microsoft DNS timeouts article (below), it seemed like I might be on to something.</p>
<ol>
<li><a href="https://docs.microsoft.com/en-US/troubleshoot/windows-server/networking/dns-client-resolution-timeouts" target="_blank" rel="noopener noreferrer">DNS Client Timeouts<i class="fas fa-external-link-square-alt ms-1"></i></a></li>
<li><a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/forwarders-resolution-timeouts" target="_blank" rel="noopener noreferrer">DNS Forwarder Timeouts<i class="fas fa-external-link-square-alt ms-1"></i></a></li>
</ol>
<p>It took me a bit to break down each timeout, and walk through the log snippet to see if any of them were reached.  It was important to keep in mind, that each timeout is independent of each other.  However, any one of them reaching their maximum elapsed time, would end the DNS resolution process.  With that in mind, let&rsquo;s diagram the exact set of events in the log snippet, so you can visualize what occurred.  Then we can break it down after the diagram.</p>
<ul>
<li>In green, you can see the <strong>client</strong> portion of the timeout.</li>
<li>In blue, you can see the DNS <strong>forwarder</strong> portion of the timeout.</li>
<li>in purple, you can see the DNS <strong>recursion</strong> portion of the timeout.</li>
</ul>
<pre class="mermaid">

sequenceDiagram
    autonumber
    actor  DNSClient
    participant WindowsDNS
    participant DNSForwarder
    participant ExternalDNS
    DNSClient->>WindowsDNS: record.domain.com?
        rect rgb(0, 255, 0)
        note over DNSClient: Starting timer for DNS client, elapsed time 0 seconds
        end
    
    WindowsDNS->>DNSForwarder: record.domain.com?
    note over WindowsDNS: I don't have this in cache, forwarding
        rect rgb(24, 14, 161)
        note over WindowsDNS: Starting timer for DNS Forwarder, elapsed time, 0 seconds
        end
        rect rgb(126, 12, 207)
        note over WindowsDNS: Starting timer for DNS Recursion, elapsed time, 0 seconds
        end
    DNSForwarder->>ExternalDNS: record.domain.com?
        rect rgb(0, 255, 0)
        note over DNSClient: Asking again, elapsed time 1 second
        end
    DNSClient->>WindowsDNS: record.domain.com?
        rect rgb(24, 14, 161)
        note over WindowsDNS: elapsed time, 1 second
        end
        rect rgb(126, 12, 207)
        note over WindowsDNS: elapsed time, 1 second
        end

        rect rgb(0, 255, 0)
        note over DNSClient: Asking again, elapsed time 2 seconds
        end
        DNSClient->>WindowsDNS: record.domain.com?

        rect rgb(24, 14, 161)
        note over WindowsDNS: elapsed time, 2 seconds
        end
        rect rgb(126, 12, 207)
        note over WindowsDNS: elapsed time, 2 seconds
        end
    
        rect rgb(24, 14, 161)
        note over WindowsDNS: elapsed time, 3 seconds, no response from forwarder, time to end
        end
        WindowsDNS->>DNSClient: record.domain.com, had an error SERVFAIL
        rect rgb(126, 12, 207)
        note over WindowsDNS: elapsed time, 3 seconds
        end
    
    note over DNSClient: :(

        rect rgb(126, 12, 207)
        note over WindowsDNS: elapsed time, between 3 and 4 seconds
        end
    DNSForwarder->>WindowsDNS: record.domain.com is located here
    note over WindowsDNS: Too late, my forwarder timeout expired!  Told the client you didn't respond.

</pre>

<p>In this case, the DNS forwarder was timing out before it got an answer.  It was taking over 3 seconds for the DNS forwarder (Azure&rsquo;s DNS) to complete it&rsquo;s first lookup.  You can see that ultimately Azure DNS <strong>does</strong> respond, but it&rsquo;s too late.  Since DNS forwarder timed out already, the client is sent a SERVFAIL response.  This is different than an NXDOMAIN response, which is confirmation that a given record or domain does not exist.  Ultimately the source of the SERVFAIL would have been a easier to identify <strong>if</strong> Windows DNS logging have simply said, something like &ldquo;forwarder timeout exceeded waiting for a response, sending SERVFAIL&rdquo;.  Instead, the logging does nothing to help you understand what has happened.</p>
<p>The 3 second timeout, is mentioned <a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/forwarders-resolution-timeouts#what-is-the-default-behavior-of-a-dns-server-when-more-than-two-dns-servers-are-configured-as-forwarders" target="_blank" rel="noopener noreferrer">here<i class="fas fa-external-link-square-alt ms-1"></i></a>, under the section <strong>ForwardingTimeout</strong>.</p>

<h2 id="why-should-a-dns-server-in-azure-be-different" data-numberify>Why should a DNS server in Azure be different?<a class="anchor ms-1" href="#why-should-a-dns-server-in-azure-be-different"></a></h2>
<p>In most non-Azure DNS setups, you&rsquo;d probably have more than one forwarder, and you&rsquo;d likely have root hints enabled as a backup.  We do not, and it&rsquo;s for the reasons below.</p>
<ol>
<li>Azure only has one DNS server IP to send requests to.</li>
<li>It&rsquo;s not scalable long term to add conditional forwarders for Azure private DNS zones.  You&rsquo;d probably be ok managing a few, but it&rsquo;s not something you&rsquo;d want across the board.</li>
<li>We can use conditional forwarder with multiple servers for specific domains, like active directory domain integrated ones.  As an aside, if your DNS server happens to be an domain controller, it&rsquo;s likely your DNS server is also authoritative for your domain.</li>
<li>We don&rsquo;t want root hints, or secondary resolvers like Google DNS.  The primary reason is in cases of split horizon / private DNS zones.  Private zones for this example, would be things like Azure Private Endpoint name resolution <strong>or</strong> DNS zones that only exist internally.  If the Azure DNS server times out and you failover to a non-Azure server, one of a few things will happen.
<ol>
<li>You&rsquo;ll resolve the <strong>public facing IP</strong> instead of your desired private IP.</li>
<li>You will get an NXDOMAIN because that DNS record / zone does not exist publicly.</li>
</ol>
</li>
</ol>
<p>If you&rsquo;re running in Azure and do NOT need to resolve Azure private DNS zones, then you can probably get away with this standard configuration.</p>

<h2 id="recommendation--solution" data-numberify>Recommendation / Solution<a class="anchor ms-1" href="#recommendation--solution"></a></h2>
<p>This is what I&rsquo;m going to do, and I&rsquo;ll report back if I start running into other unexpected issues.</p>
<p>Below is a list of what we had in-place before, and this is not changing.</p>
<ol>
<li>Set the DNS forwarder to 168.63.129.16 <strong>only</strong>.</li>
<li>Leverage conditional forwarders for any other domain specific use case like AD.</li>
<li>Disable root hints.</li>
</ol>
<p>As for what I changed that made the difference?  I changed the default dns forwarder timeout of 3 seconds to 6.  This is a more than reasonable timeout in a single forwarder design in my opinion.  The spirit of the default timeouts were likely based around an assumption that you would have at least two forwarders, and also failover to root hints.</p>

<h2 id="alternative-ideas" data-numberify>Alternative ideas?<a class="anchor ms-1" href="#alternative-ideas"></a></h2>
<p>I suppose you <em>could</em> still increase the default forwarder timeout to something greater than 3 seconds, and then add a backup forwarder for internet resolution.  However, <strong>I</strong> feel that if internal Azure DNS resolution is important to your infrastructure, this could cause more harm than it would solve.  Yes, you would be able to resolve public addresses, but that also might be a problem to.</p>

<h2 id="closing" data-numberify>Closing<a class="anchor ms-1" href="#closing"></a></h2>
<p>Most DNS servers respond in less than 4 seconds, which is why this was such a tough issue for us to troubleshoot.  Even in this case, the issues was very sporadic and at most twice a day.  Ultimately, if a DNS resolution is taking longer than 3 seconds to respond, that&rsquo;s an issue.  However, taking longer than 3 seconds, and not responding at all are two completely different.  This change gives the external DNS resolution a bit more time to complete.</p>
<p>Hopefully this helps you if you&rsquo;re running into similar issues, or just wanted to know how to troubleshoot Windows DNS.</p>
</div>
</div>
</div><div class="card-footer">
  <div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
      <i class="fas fa-fw fa-chevron-down post-prev-icon me-1" data-fa-transform="rotate-90"></i>
      <a href="/azure-bicep-conditional-properties-part-04-helper-modules/">Azure Bicep Conditional Properties Part 04, Helper Modules</a>
    </div><div class="post-nav post-next">
      <a href="/naming-conventions-azure-locations/">Naming Conventions: Azure Locations</a>
      <i class="fas fa-fw fa-chevron-down post-next-icon ms-1" data-fa-transform="rotate-270"></i>
    </div></div>
</div></article><div class="post-copyright mb-3 row card component" id="post-copyright">
    <div class="card-header">
        <h2 class="card-title fs-4 my-2 text-surface">Copyright</h2>
    </div>
    <div class="card-body"><a class="d-flex align-items-center flex-column" target="_blank" rel="license noopener noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">
  <span><i class="fab fa-fw fa-2x fa-creative-commons"></i><i class="fab fa-fw fa-2x fa-creative-commons-by"></i><i class="fab fa-fw fa-2x fa-creative-commons-sa"></i></span>
  CC BY-SA 4.0 
</a>


    </div>
</div><section class="related-posts row card component">
      <div class="card-header">
        <h2 class="card-title fs-4 my-2 text-surface">
          Related Posts
        </h2>
      </div>
      <div class="card-body slide px-1">
        <div class="slide-inner row gx-0"><div class="col-12 col-md-6 col-lg-4 me-2">
            <div class="post-card card card-body p-0 border-0 surface">
  
  <div
    class="post-card-default-img card-img-top d-flex align-items-center justify-content-center bg-body-secondary mb-1">
    NO IMAGE
  </div>

  <a class="post-title" href="/azure-bicep-conditional-properties-part-04-helper-modules/">
    Azure Bicep Conditional Properties Part 04, Helper Modules
  </a>
  <div class="post-meta mb-0">
    Sat, 10 Sep 2022 12:00:00 &#43;0000

  </div>
</div>

          </div><div class="col-12 col-md-6 col-lg-4 me-2">
            <div class="post-card card card-body p-0 border-0 surface">
  
  <div
    class="post-card-default-img card-img-top d-flex align-items-center justify-content-center bg-body-secondary mb-1">
    NO IMAGE
  </div>

  <a class="post-title" href="/azure-bicep-conditional-properties-part-03-template-variables/">
    Azure Bicep Conditional Properties Part 03, Template Variables
  </a>
  <div class="post-meta mb-0">
    Sun, 28 Aug 2022 12:00:00 &#43;0000

  </div>
</div>

          </div><div class="col-12 col-md-6 col-lg-4 me-2">
            <div class="post-card card card-body p-0 border-0 surface">
  
  <div
    class="post-card-default-img card-img-top d-flex align-items-center justify-content-center bg-body-secondary mb-1">
    NO IMAGE
  </div>

  <a class="post-title" href="/azure-bicep-conditional-properties-part-02-parameters/">
    Azure Bicep Conditional Properties Part 02, Parameters
  </a>
  <div class="post-meta mb-0">
    Sun, 21 Aug 2022 13:00:00 &#43;0000

  </div>
</div>

          </div><div class="col-12 col-md-6 col-lg-4 me-2">
            <div class="post-card card card-body p-0 border-0 surface">
  
  <div
    class="post-card-default-img card-img-top d-flex align-items-center justify-content-center bg-body-secondary mb-1">
    NO IMAGE
  </div>

  <a class="post-title" href="/azure-bicep-conditional-properties-part-01-introduction/">
    Azure Bicep Conditional Properties Part 01, Introduction
  </a>
  <div class="post-meta mb-0">
    Sun, 21 Aug 2022 12:00:00 &#43;0000

  </div>
</div>

          </div><div class="col-12 col-md-6 col-lg-4 me-2">
            <div class="post-card card card-body p-0 border-0 surface">
  
  <div
    class="post-card-default-img card-img-top d-flex align-items-center justify-content-center bg-body-secondary mb-1">
    NO IMAGE
  </div>

  <a class="post-title" href="/iac-creativity-introduction/">
    IaC Creativity: Introduction
  </a>
  <div class="post-meta mb-0">
    Fri, 05 Mar 2021 12:00:00 &#43;0500

  </div>
</div>

          </div></div>
        <button class="slide-control-left">
          <i class="fas fa-2x fa-chevron-circle-down" data-fa-transform="rotate-90"></i>
          <span class="visually-hidden">Left</span>
        </button>
        <button class="slide-control-right">
          <i class="fas fa-2x fa-chevron-circle-down" data-fa-transform="rotate-270"></i>
          <span class="visually-hidden">Right</span>
        </button>
      </div>
    </section><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title my-2 fs-4 text-surface">Comments</h2>
  </div>
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="ericcsinger/ericcsinger.github.io"
  issue-term="title"
  label="comment"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>



</div>
</div></div>
</div>
<aside class="col-xxl-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    
<div class="accordion profile">
  <div class="accordion-item card row text-center component">
    <div class="accordion-header card-header border-0" id="profile-header">
      <a
        class="accordion-button d-lg-none mb-2 shadow-none p-0 bg-transparent text-surface"
        role="button" data-bs-toggle="collapse" href="#profile" aria-expanded="true" aria-controls="profile">
        Profile
      </a>
    </div>
    <div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id="profile" aria-labelledby="profile-header">
      <div class="col-12 d-flex align-items-center justify-content-center"><picture><img class="profile-avatar rounded-circle " alt="Eric C. Singer" src="https://ericcsinger.com/about/headshot.webp?v=474438880c076aa6bcfa6a5e9186211d" loading="lazy" data-viewer-invisible width="2316" height="3088" />
</picture>
</div>
      <div class="col-12 profile-meta"><div class="profile-name fw-fold fs-lg">Eric C. Singer</div><div class="profile-bio">An enthusiastic IT professional, focused on designing and automating infrastructure since 2002.</div><div class="profile-location"><i class="fas fa-fw fa-map-marker-alt"></i>Quakertown, PA</div><a class="profile-about text-primary" href="/about/"><i class="fas fa-fw fa-user"></i>About Me</a></div></div>
  </div>
</div>


<div class="accordion taxonomies-toggle">
    <div class="row card component accordion-item">
        <div class="accordion-header card-header border-0">
            <a
                class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent"
                role="button" data-bs-toggle="collapse" href="#taxonomies-toggle" aria-expanded="true" aria-controls="taxonomies-toggle">
                Taxonomies
            </a>
        </div>
        <div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id="taxonomies-toggle">
            <ul class="nav nav-pills nav-fill" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="taxonomyTagsTab" data-bs-toggle="tab" data-bs-target="#taxonomyTags" 
                            type="button" role="tab" aria-controls="taxonomyTags" aria-selected="true">
                            Tags
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="taxonomyCategoriesTab" data-bs-toggle="tab" data-bs-target="#taxonomyCategories" 
                            type="button" role="tab" aria-controls="taxonomyCategories" aria-selected="true">
                            Categories
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="taxonomySeriesTab" data-bs-toggle="tab" data-bs-target="#taxonomySeries" 
                            type="button" role="tab" aria-controls="taxonomySeries" aria-selected="true">
                            Series
                        </button>
                    </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="taxonomyArchivesTab" data-bs-toggle="tab" data-bs-target="#taxonomyArchives" 
                        type="button" role="tab" aria-controls="taxonomyArchives" aria-selected="true">
                        Archives
                    </button>
                </li>
            </ul>
            
            <div class="tab-content mt-3">
                    <div class="tab-pane active" id="taxonomyTags" role="tabpanel" aria-labelledby="taxonomyTagsTab" tabindex="0">
                        <a href="/tags/powershell/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Powershell">
                            Powershell
                            <span class="badge badge-sm text-secondary bg-white ms-1">19</span>
                        </a>
                        <a href="/tags/azure/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Azure">
                            Azure
                            <span class="badge badge-sm text-secondary bg-white ms-1">9</span>
                        </a>
                        <a href="/tags/microsoft/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Microsoft">
                            Microsoft
                            <span class="badge badge-sm text-secondary bg-white ms-1">9</span>
                        </a>
                        <a href="/tags/automation/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Automation">
                            Automation
                            <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
                        </a>
                        <a href="/tags/backup/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Backup">
                            Backup
                            <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
                        </a>
                        <a href="/tags/sql/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="SQL">
                            SQL
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Storage">
                            Storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/vmware/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Vmware">
                            Vmware
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/wsus/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Wsus">
                            Wsus
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/tags/arm/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Arm">
                            Arm
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/bicep/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Bicep">
                            Bicep
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/iac/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="IaC">
                            IaC
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/thinking-out-loud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Thinking Out Loud">
                            Thinking Out Loud
                            <span class="badge badge-sm text-secondary bg-white ms-1">5</span>
                        </a>
                        <a href="/tags/naming-conventions/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Naming Conventions">
                            Naming Conventions
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/tags/review/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Review">
                            Review
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/tags/windows/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Windows">
                            Windows
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/tags/active-directory/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Active Directory">
                            Active Directory
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/cloud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Cloud">
                            Cloud
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/commvault/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Commvault">
                            Commvault
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/jams/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="JAMS">
                            JAMS
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/nimble-storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Nimble Storage">
                            Nimble Storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/reviews/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Reviews">
                            Reviews
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/scripting/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Scripting">
                            Scripting
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/t-sql/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="T-SQL">
                            T-SQL
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/tags/centralized-job-management/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title="Centralized Job Management">
                            Centralized Job Management
                            <span class="badge badge-sm text-secondary bg-white ms-1">2</span>
                        </a>
                        <a href="https://ericcsinger.com/tags" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title='ALL'>
                        ALL
                        <span class="badge badge-sm text-secondary bg-white ms-1">67</span>
                        </a>
                    </div>
                    <div class="tab-pane" id="taxonomyCategories" role="tabpanel" aria-labelledby="taxonomyCategoriesTab" tabindex="0">
                        <a href="/categories/uncategorized/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Uncategorized">
                            Uncategorized
                            <span class="badge badge-sm text-secondary bg-white ms-1">48</span>
                        </a>
                        <a href="/categories/backup/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Backup">
                            Backup
                            <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
                        </a>
                        <a href="/categories/storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Storage">
                            Storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/categories/thinking-out-loud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Thinking Out Loud">
                            Thinking Out Loud
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                        <a href="/categories/naming-conventions/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Naming Conventions">
                            Naming Conventions
                            <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
                        </a>
                        <a href="/categories/cloud/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Cloud">
                            Cloud
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                        <a href="/categories/licensing/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Licensing">
                            Licensing
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                        <a href="/categories/monitoring/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Monitoring">
                            Monitoring
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                        <a href="/categories/servers/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-category me-2 mb-2" title="Servers">
                            Servers
                            <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
                        </a>
                    </div>
                    <div class="tab-pane" id="taxonomySeries" role="tabpanel" aria-labelledby="taxonomySeriesTab" tabindex="0">
                        <a href="/series/backup-storage/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Backup Storage">
                            Backup Storage
                            <span class="badge badge-sm text-secondary bg-white ms-1">8</span>
                        </a>
                        <a href="/series/azure-bicep-conditional-properties/" class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title="Azure Bicep Conditional Properties">
                            Azure Bicep Conditional Properties
                            <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
                        </a>
                    </div>
                <div class="tab-pane" id="taxonomyArchives" role="tabpanel" aria-labelledby="taxonomyArchivesTab" tabindex="0">

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2024">
    2024 <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2023">
    2023 <span class="badge badge-sm text-secondary bg-white ms-1">1</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2022">
    2022 <span class="badge badge-sm text-secondary bg-white ms-1">6</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2021">
    2021 <span class="badge badge-sm text-secondary bg-white ms-1">3</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2020">
    2020 <span class="badge badge-sm text-secondary bg-white ms-1">4</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2019">
    2019 <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2018">
    2018 <span class="badge badge-sm text-secondary bg-white ms-1">7</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2017">
    2017 <span class="badge badge-sm text-secondary bg-white ms-1">17</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2016">
    2016 <span class="badge badge-sm text-secondary bg-white ms-1">17</span>
    </a>

    <a href="" class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title="2015">
    2015 <span class="badge badge-sm text-secondary bg-white ms-1">16</span>
    </a>


                </div>
            </div>
        </div>
    </div>
</div>
    <div class="accordion posts-toggle">
      <div class="row card component accordion-item">
        <div class="accordion-header card-header border-0">
          <a
            class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent"
            role="button"
            data-bs-toggle="collapse"
            href="#posts-toggle"
            aria-expanded="true"
            aria-controls="posts-toggle">
            Posts
          </a>
        </div>
        <div
          class="card-body collapse accordion-collapse accordion-body d-lg-block show"
          id="posts-toggle">
          <ul class="nav nav-pills nav-fill" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="recent-posts-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#recent-posts"
                  type="button"
                  role="tab"
                  aria-controls="recent-posts"
                  aria-selected="true">
                  Recent Posts
                </button>
              </li>
          </ul>

          <div class="tab-content mt-3">
              <div
                class="tab-pane active"
                id="recent-posts"
                role="tabpanel"
                aria-labelledby="recent-posts-tab"
                tabindex="0">
                <ul class="post-list list-unstyled ms-1">
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/thinking-out-loud-shared-vs.-dedicated-infrastructure/">
        Thinking out loud: Shared vs. Dedicated Infrastructure
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sun, 23 Jun 2024 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/pgadmin-azure-ad-authentication-token-renewal/">
        PGAdmin Azure AD Authentication Token Renewal
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sat, 24 Jun 2023 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/naming-conventions-azure-locations/">
        Naming Conventions: Azure Locations
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sun, 30 Oct 2022 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/problem-solving-windows-dns-server-in-azure-returns-servfail/">
        Problem Solving: Windows DNS Server in Azure returns SERVFAIL
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sat, 24 Sep 2022 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                    <li class="mb-2">
  <div class="d-flex">
    <div
      class="flex-grow-1 d-flex flex-column h-auto justify-content-center">
      <a class="post-title" href="/azure-bicep-conditional-properties-part-04-helper-modules/">
        Azure Bicep Conditional Properties Part 04, Helper Modules
      </a>
      <div class="post-meta mt-2">
        <span class="post-date">
          Sat, 10 Sep 2022 12:00:00 &#43;0000
        </span>
      </div>
    </div>
  </div>
                    </li>
                </ul>
              </div>
          </div>
        </div>
      </div>
    </div>
<div class="accordion post-toc d-none d-lg-block">
  <div class="accordion-item row mb-4 card component" id="postTOC">
    <div class="card-header accordion-header">
      <h2 class="card-title fs-4 my-2 text-surface d-none d-lg-block">Contents</h2>
      <a class="accordion-button d-lg-none mb-1 collapsed shadow-none p-0 bg-transparent" role="button" data-bs-toggle="collapse" href="#post-toc" aria-expanded="false" aria-controls="post-toc">
        Contents
      </a>
    </div>
    <div class="card-body collapse accordion-collapse accordion-body d-lg-block" id="post-toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#dns-setup">DNS Setup</a></li>
    <li><a href="#discovering-and-understanding-the-problem">Discovering and understanding the problem</a></li>
    <li><a href="#diagnostics">Diagnostics</a>
      <ul>
        <li><a href="#diagnostic-results">Diagnostic Results</a></li>
      </ul>
    </li>
    <li><a href="#why-should-a-dns-server-in-azure-be-different">Why should a DNS server in Azure be different?</a></li>
    <li><a href="#recommendation--solution">Recommendation / Solution</a></li>
    <li><a href="#alternative-ideas">Alternative ideas?</a></li>
    <li><a href="#closing">Closing</a></li>
  </ul>
</nav>
    </div>
  </div>
</div>





    
  </div>
</aside>

      </div>
    </main><footer class="footer mt-auto py-3 text-center container"><div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="offcanvasActionsPanel"
  aria-labelledby="offcanvasActionsPanelLabel">
  <div class="offcanvas-header">
    <div class="offcanvas-title h5" id="offcanvasActionsPanelLabel">
      <i class="fas fa-fw fa-th-large me-1"></i>
      Actions
    </div>
    <button type="button" class="btn-close ms-auto" data-bs-dismiss="offcanvas" data-bs-target="offcanvasActionsPanel" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body mt-2"><div class="social-share mb-4 d-flex overflow-auto">
      <a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=404%20Page%20not%20found&url=https%3a%2f%2fericcsinger.com%2f404.html">
        <i class="fab fa-2x fa-fw fa-twitter mb-2"></i> Twitter
      </a>
      <a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Facebook Share Button"
        target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fericcsinger.com%2f404.html">
        <i class="fab fa-2x fa-fw fa-facebook-f mb-2"></i> Facebook
      </a>
    </div>
    <hr class="mb-4"><div class="actions d-flex overflow-auto align-items-center">
      <a role="button" class="action action-go-back d-flex flex-column align-items-center me-3" href="javascript: window.history.back();">
        <span class="action-icon mb-2"><i class="fas fa-2x fa-chevron-circle-down" data-fa-transform="rotate-90"></i></span> Go back
      </a>
      <a role="button" class="action action-reload-page d-flex flex-column align-items-center me-3">
        <span class="action-icon mb-2"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
      </a>
      <a role="button" class="action action-copy-url d-flex flex-column align-items-center me-3">
        <span class="action-icon mb-2"><i class="fas fa-2x fa-link"></i></span> Copy URL
      </a>
    </div>
  </div>
</div><div class="row text-center">
  <div class="col-12 mt-2">
    <p class="mb-2">Eric&#39;s Blog</p>
    <p class="text-secondary mb-2"><small>Eric IT Blog</small></p><div class="copyright mb-2 text-secondary">
  <small>©2025, Eric C. Singer
</small>
</div>
<div class="powered-by mb-2 text-secondary">
  <small>
    Build with ❤️ from the <a class="text-primary" href="https://gohugo.io" target="_blank" rel="noopener noreferrer">Hugo</a> and the <a class="text-primary" href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank" rel="noopener noreferrer">HBS</a> theme.
  </small>
</div>


<nav class="social-links nav justify-content-center mb-2 mt-3">
      <a class="nav-link social-link p-0 me-1 mb-2" target="_blank" href="https://github.com/ericcsinger" title="GitHub" rel="me">
        <i class="fa-fw fa-2x fab fa-github"
          ></i>
      </a>
      <a class="nav-link social-link p-0 me-1 mb-2" target="_blank" href="https://linkedin.com/in/ericcsinger" title="LinkedIn" rel="me">
        <i class="fa-fw fa-2x fab fa-linkedin-in"
           style="color: #0a66c2;"></i>
      </a>
      <a class="nav-link social-link p-0 me-1 mb-2" target="_blank" href="https://stackoverflow.com/users/1239030" title="Stack Overflow" rel="me">
        <i class="fa-fw fa-2x fab fa-stack-overflow"
           style="color: #f48024;"></i>
      </a>
      <a class="nav-link social-link p-0 me-1 mb-2" target="_blank" href="https://twitter.com/esinger" title="Twitter" rel="me">
        <i class="fa-fw fa-2x fab fa-twitter"
           style="color: #1d9bf0;"></i>
      </a>
  <a class="nav-link social-link p-0 me-1 mb-2" target="_blank" data-rss-feed href="https://ericcsinger.com/index.xml" title="RSS" rel="me">
    <i class="fas fa-fw fa-2x fa-rss" style="color: #ea6221;"></i>
  </a>
</nav>
</div>
  <div class="col-12 col-lg-8 offset-0 offset-lg-1"></div>
</div>
</footer>
<script data-precache src="/assets/main/bundle.min.8fb955cb1935fe23042ba0b0bfee9d8ee684a3b7e559915ffdc6fa74e1381632.js" integrity="sha256-j7lVyxk1/iMEK6Cwv&#43;6djuaEo7flWZFf/cb6dOE4FjI=" crossorigin="anonymous" async></script><script data-precache src="/assets/icons/bundle.min.16eedf63f2c395d2073253764cf197c28b18ac0264a7e0722c9b5b68f38201de.js" integrity="sha256-Fu7fY/LDldIHMlN2TPGXwosYrAJkp&#43;ByLJtbaPOCAd4=" crossorigin="anonymous" defer></script>
<script data-precache src="/assets/viewer/bundle.min.06371891cfe6d10d36cba465c61c4d7cb17591a3be2fd9af4a38444d2074e709.js" integrity="sha256-BjcYkc/m0Q02y6RlxhxNfLF1kaO&#43;L9mvSjhETSB05wk=" crossorigin="anonymous" defer></script>
  <script data-precache defer src="/assets/katex/bundle.min.ba733dc1a647d4293d838a9c0c37db25ab829bb2d7b4c00e2df53e2b663db53c.js" integrity="sha256-unM9waZH1Ck9g4qcDDfbJauCm7LXtMAOLfU&#43;K2Y9tTw=" crossorigin="anonymous"></script>
<script data-precache defer src="/assets/mermaid/bundle.min.ea0d8697acc1070ab4802e74f84aabc3335d27192c6573700fd8370c1fbd0270.js" integrity="sha256-6g2Gl6zBBwq0gC50&#43;EqrwzNdJxksZXNwD9g3DB&#43;9AnA=" crossorigin="anonymous"></script>



  </body>
</html>
